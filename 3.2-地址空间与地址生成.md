# 3.2 地址空间与地址生成

[TOC]

### 地址空间

* **物理地址空间**：硬件支持的地址空间，物理内存的管理和控制由硬件完成

  >如内存条对应的主存，以及磁盘对应的另一种存储空间

* **逻辑地址空间**：一个运行的程序所看到的内存空间，最终是要落实在物理地址空间的

  > 应用程序看到的内存空间很简单，是一维线性的



### 逻辑地址生成

* 二者需要OS来建立映射关系
* 逻辑地址生成：

```ascii
.c file
|        编译
.s file
|        汇编：.o程序起始地址都是从0开始
.o file
|        链接：把多个.o文件变为一个可执行程序
.exe file
|        载入（程序重定位）：通过loader把执行程序放到内存中运行
程序在内存中
         //到这里为止还是逻辑地址，是应用程序所看到的地址，并不是物理地址
```

* 从逻辑地址到物理地址的过程：

  * **操作系统方面**：

    * 建立逻辑地址和物理地址之间的映射关系（在以下四步之前）

      > 放在内存中由CPU缓存，从而加快下面四个过程

  * **CPU方面**：

    1. CPU要执行某条指令时，ALU部件需要指定内容，发出请求，参数为逻辑地址
    2. CPU中的MMU去查找逻辑地址的映射表中是否有对应的物理地址，没有找到的话就会产生一个处理过程，MMU没有的话就去内存中找
    3. 找到了的话，CPU控制器通过总线，给主存发送请求找该物理地址的内容

  * **内存方面**：
    
    4. 主存将物理地址内存中的内容通过总线传给CPU



### 地址安全检查

* 要让内存中的程序不会相互干扰，要确保每个程序访问的地址空间是合法的，或者说是限制在约束范围之内

  > 也是操作系统完成的

```ascii
                   内存异常
                      ▲                                   ┼-----┼------MAX
                      | no                                ┼-----┼
┌──────┐  逻辑地址   ┌──┼──┐            ┌────┐  物理地址     ┼-----┼-----1500───┐
│ CPU  │───────────>│ <= │ ──────────>│  + │ ───────────> ┼┼┼┼┼┼┼            |
└──────┘            └────┘   yes      └────┘              ┼┼┼┼┼┼┼            |
 ▲                    500              1000               ┼┼┼┼┼┼┼    程序的物理地址空间
 |                    界限 <-----┼-----> 基址              ┼┼┼┼┼┼┼             |
 |指令                寄存器      |      寄存器              ┼-----┼------1000───┘
 |                              |                         ┼-----┼
┌┼ MAXprog ───────────┐      操作系统方面                   ┼-----┼
│         程序         │                                   ┼-----┼------0
│        逻辑地址空间   |
└─────────────────────┘

```

* 操作系统设置逻辑地址空间的基址和界限
* 区域限制的映射表也是OS建立的
# 3.1 计算机体系结构和内存分层体系

[TOC]

### 计算机基本硬件结构

* CPU

  > 程序执行在这
  >
  > 包括运算器，寄存器，控制器，缓存（Cache），存储管理单元（MMU）

* 内存

  > 当执行时程序代码和数据驻留在这

* 外设（I/O）

  > 磁盘、鼠标



### 内存的层次结构

> 即CPU访问的指令和数据的位置

* 金字塔结构：往下速度越慢但空间越大

```ascii
┌─ 微处理器 ────────────────────────────────────┐
│ ┌─────────────────┐                         │
│ │     CPU寄存器    │                         │
│ ┼─────────────────┼                         │
│ │     L1缓存       │       最快  3.6GHz       │
│ └────────┼────────┘                         |
│          |                                  |
│          ▼                                  |
│ ┌─────────────────┐                         │
│ │     L2缓存       │       稍快               │
│ └────────┼────────┘                         |
└──────────┼─────────────────────────────────—┘
-----------┼-------------------------------------cache miss/fill----------------
           ▼
  ┌─────────────────┐
  │       主存       │       快   1.3GHz
  └────────┼────────┘
           ▼  交换/分页
  ┌─────────────────┐
  │  磁盘（虚拟内存）  │       慢   5ms（寻道时间）
  └────────-────────┘
```



### 操作系统管理内存

* 4个重要目标

  1. **抽象**：连续的逻辑地址空间

     > 不需要考虑底层细节如物理存储在何处，外设在何处

  2. **保护**：独立地址空间

     > 不同进程有可能访问破坏别的进程的地址空间，需要OS进行隔离

  3. **共享**：共享空间，访问相同内存

     > 通过OS安全可靠地进行数据的传递

  4. **虚拟化**：更多的地址空间

     > 最需要的数据放在内存中，而暂时不需要的放到硬盘上，从而实现更大的虚拟空间
     >
     > * 保持对应用程序透明
     > * 实现了更大的地址空间

* 在操作系统中管理内存的不同方法：
  * 程序重定位
  * 分段
  * 分页
  * 虚拟内存
  * 按需分页虚拟内存
* **实现高度依赖于硬件**
  * 必须知道内存架构
  * MMU（内存管理单元）：硬件组件负责处理CPU的内存访问请求


# 10.2-10.4 信号量

[TOC]

### 信号量

* 抽象数据类型
  * 一个整型`sem`，两个**原子**操作
  * `P()`：`sem`减1，如果`sem<0`则等待，否则继续
  * `V()`：`sem`加1，如果`sem<=0`则唤醒一个等待的`P`



___

### 信号量的使用

##### 信号量的属性

* 信号量是**整数**
* 信号量是**被保护**的变量
  * 初始化完成后，唯一改变信号量的值的办法是通过`P()`和`V()`
  * 操作必须是原子

* `P()`能够阻塞，`V()`不会阻塞

  > 多次`P()`之后，如果`sem<0`则该进程等待，需要另一个进程执行`V()`操作唤醒

* 我们假定信号量是**公平**的

  * 没有线程被阻塞在`P()`仍然阻塞，如果`V()`被无限频繁调用（在同一个信号量）

  * 在实践中，`FIFO`经常被使用

    > 即在有数个进程等待时，通常使用先进先出算法来决定`V()`唤醒哪个进程

* 两种类型信号量

  1. **二进制信号量**：`0`或`1`，可以实现`lock`的功能

     > 锁机制中，同一时刻访问某个内存空间的只能有一个进程，互斥

  2. **一般/计数信号量**：可取任何非负值，允许多个执行`P()`操作的进程进入`P()`操作之后的步骤

     > 而一般信号量会导致多个进程进入临界区

  * 两者相互表现（给定一个，可以实现另一个）

* 信号量可以用在两个方面

  1. 互斥

  2. 条件同步

     > 调度约束，一个线程等待另一个线程的事情发生



##### 用二进制信号量实现互斥



